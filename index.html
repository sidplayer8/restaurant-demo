<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gourmet Bites v3.1 - Critical Bug Fixes</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
</head>

<body>
    <div id="app">
        <!-- Login View -->
        <section id="login-view" class="view active">
            <div class="login-container">
                <div class="brand-logo">
                    <span class="material-icons-round">restaurant</span>
                </div>
                <h1>Gourmet Bites v3.1</h1>
                <p class="subtitle">Experience the best food in town</p>

                <button id="google-login-btn" class="btn-google">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google Logo">
                    <span>Sign in with Google</span>
                </button>


                <div class="divider"><span>OR</span></div>

                <form id="login-form">
                    <div id="phone-step">
                        <div class="input-group">
                            <span class="material-icons-round">phone</span>
                            <input type="tel" id="phone" placeholder="Phone number" required>
                        </div>
                        <button type="button" id="send-code-btn" class="btn-primary">Send Code</button>
                    </div>
                    <div id="verification-step" class="hidden">
                        <p>Code sent to <strong id="phone-display"></strong></p>
                        <div class="input-group">
                            <span class="material-icons-round">lock</span>
                            <input type="text" id="verification-code" placeholder="6-digit code" maxlength="6">
                        </div>
                        <button type="button" id="verify-code-btn" class="btn-primary">Verify</button>
                        <button type="button" id="back-to-phone" class="btn-secondary">Back</button>
                    </div>
                </form>

                <p class="disclaimer" style="margin-top: 24px;">
                    <a href="#/admin" id="admin-login-link-main"
                        style="color: var(--primary); text-decoration: none;">Admin?
                        Click here to login</a>
                </p>
            </div>
        </section>

        <!-- App-level Modals -->
        <div id="admin-login-modal" class="modal hidden">
            <div class="modal-content" style="max-width: 400px; margin: auto;">
                <header class="modal-header">
                    <h2>Admin Login</h2>
                    <button id="close-admin-login" class="icon-btn">
                        <span class="material-icons-round">close</span>
                    </button>
                </header>
                <form id="admin-login-form">
                    <div class="input-group">
                        <span class="material-icons-round">person</span>
                        <input type="text" id="admin-user" placeholder="Username" required>
                    </div>
                    <div class="input-group">
                        <span class="material-icons-round">lock</span>
                        <input type="password" id="admin-pass" placeholder="Password" required>
                    </div>
                    <button type="submit" id="admin-login-submit-btn" class="btn-primary full-width">Login</button>
                </form>
            </div>
        </div>

        <!-- Item Modal (Add/Edit) -->
        <div id="item-modal" class="modal hidden">
            <div class="modal-content">
                <header class="modal-header">
                    <h2 id="item-modal-title">Edit Item</h2>
                    <button id="close-item-modal" class="icon-btn">
                        <span class="material-icons-round">close</span>
                    </button>
                </header>
                <form id="item-form">
                    <input type="hidden" id="item-id">

                    <div class="input-group">
                        <span class="material-icons-round">label</span>
                        <input type="text" id="item-name" placeholder="Item Name" required>
                    </div>

                    <div class="input-group">
                        <span class="material-icons-round">category</span>
                        <select id="item-category" required
                            style="width:100%; background:none; border:none; color:white; outline:none; font-family:inherit;">
                            <!-- Options injected by JS -->
                        </select>
                    </div>

                    <div class="input-group">
                        <span class="material-icons-round">image</span>
                        <input type="text" id="item-image" placeholder="Image URL (e.g. burger.jpg)" required>
                    </div>

                    <div class="input-group">
                        <span class="material-icons-round">description</span>
                        <textarea id="item-desc" placeholder="Description" rows="3"
                            style="width:100%; background:none; border:none; color:white; outline:none; font-family:inherit; resize:none;"></textarea>
                    </div>

                    <div class="input-group">
                        <span class="material-icons-round">warning</span>
                        <input type="text" id="item-allergens" placeholder="Allergens (comma separated)">
                    </div>

                    <div class="input-group">
                        <span class="material-icons-round">attach_money</span>
                        <input type="number" id="item-price" placeholder="Price" step="0.01" required>
                    </div>

                    <button type="submit" class="btn-primary full-width">Save Item</button>
                    <button type="button" id="delete-item-btn" class="btn-secondary full-width hidden"
                        style="margin-top:10px; background:rgba(255,0,0,0.2); color:#ff6b6b;">Delete
                        Item</button>
                </form>
            </div>
        </div>

        <!-- Main View (Menu) -->
        <section id="main-view" class="view hidden">
            <header class="app-header">
                <div class="header-content">
                    <div class="user-info">
                        <div id="user-avatar" class="user-avatar hidden">
                            <img src="" alt="User">
                        </div>
                        <div id="default-avatar" class="user-avatar default">
                            <span class="material-icons-round">person</span>
                        </div>
                        <div class="user-text">
                            <span class="greeting">Welcome back,</span>
                            <span id="user-phone" class="user-phone">Guest</span>
                        </div>
                    </div>
                    <button id="logout-btn" class="icon-btn">
                        <span class="material-icons-round">logout</span>
                    </button>
                </div>

                <div class="category-scroll">
                    <!-- Categories injected by JS -->
                </div>
            </header>

            <main class="menu-container">
                <div id="menu-grid" class="menu-grid">
                    <!--Menu items injected by JS -->
                </div>
            </main>
        </section>

        <!-- Profile View -->
        <section id="profile-view" class="view hidden">
            <header class="app-header">
                <div class="header-content">
                    <h2>My Profile</h2>
                    <button id="logout-btn-profile" class="icon-btn">
                        <span class="material-icons-round">logout</span>
                    </button>
                </div>
            </header>

            <div class="profile-container">
                <div class="profile-card">
                    <div class="profile-avatar">
                        <img id="profile-img-large" src="" alt="Profile" class="hidden">
                        <span id="profile-initial" class="material-icons-round">person</span>
                    </div>
                    <h3 id="profile-name">Guest User</h3>
                    <p id="profile-phone">No phone linked</p>
                </div>

                <div class="section-title">Order History</div>
                <div id="order-history" class="order-list">
                    <!-- Orders injected by JS -->
                </div>
            </div>
        </section>

        <!-- Bottom Navigation -->
        <nav id="bottom-nav" class="bottom-nav hidden">
            <button class="nav-item active" onclick="switchTab('menu')">
                <span class="material-icons-round">restaurant_menu</span>
                <span>Menu</span>
            </button>
            <button class="nav-item" onclick="switchTab('cart')">
                <span class="material-icons-round">shopping_bag</span>
                <span>Cart</span>
                <span id="nav-cart-count" class="badge hidden">0</span>
            </button>
            <button class="nav-item" onclick="switchTab('profile')">
                <span class="material-icons-round">person</span>
                <span>Profile</span>
            </button>
        </nav>

        <!-- Cart Modal -->
        <div id="cart-modal" class="modal hidden">
            <div class="modal-content">
                <header class="modal-header">
                    <h2>Your Order</h2>
                    <button id="close-cart" class="icon-btn">
                        <span class="material-icons-round">close</span>
                    </button>
                </header>
                <div id="cart-items" class="cart-items">
                    <!-- Cart items injected by JS -->
                </div>
                <footer class="modal-footer">
                    <div class="total-row">
                        <span>Total</span>
                        <span id="modal-total">$0.00</span>
                    </div>
                    <button id="checkout-btn" class="btn-primary full-width">Place Order</button>
                </footer>
            </div>
        </div>

        <!-- Customization Modal -->
        <div id="customize-modal" class="modal hidden">
            <div class="modal-content">
                <header class="modal-header">
                    <h2 id="customize-title">Customize Item</h2>
                    <button id="close-customize" class="icon-btn">
                        <span class="material-icons-round">close</span>
                    </button>
                </header>
                <div class="customize-body">
                    <div id="customize-allergens" class="allergen-warning hidden">
                        <span class="material-icons-round">warning</span>
                        <span id="allergen-text"></span>
                    </div>

                    <div class="customize-section">
                        <h3>Special Instructions</h3>
                        <textarea id="special-instructions" placeholder="E.g. No onions, sauce on side..."></textarea>
                    </div>

                    <div class="customize-section">
                        <h3>Preferences</h3>
                        <div id="customize-options" class="options-list">
                            <!-- Options injected by JS -->
                        </div>
                    </div>
                </div>
                <footer class="modal-footer">
                    <div class="total-row">
                        <span>Total</span>
                        <span id="customize-total">$0.00</span>
                    </div>
                    <button id="add-custom-btn" class="btn-primary full-width">Add to Order</button>
                </footer>
            </div>
        </div>

        <!-- Floating Action Button (Cart) -->
        <div id="cart-fab" class="cart-fab hidden">
            <div class="cart-info">
                <span class="item-count">0 Items</span>
                <span class="cart-total">$0.00</span>
            </div>
            <button id="view-cart-btn">View Cart</button>
        </div>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Firebase Compat SDKs for file:// protocol support -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script src="firebase-config.js"></script>
    <!-- Order Success Modal -->
    <div id="order-success-modal" class="modal hidden">
        <div class="modal-content" style="text-align:center; align-items:center;">
            <div
                style="width:80px; height:80px; background:var(--success); border-radius:50%; display:flex; align-items:center; justify-content:center; margin-bottom:20px; box-shadow:0 10px 20px rgba(0,200,83,0.3);">
                <span class="material-icons-round" style="font-size:48px; color:white;">check</span>
            </div>
            <h2 style="margin-bottom:10px;">Order Placed!</h2>
            <p style="color:var(--text-muted); margin-bottom:24px;">The kitchen is preparing your food right now.</p>
            <button onclick="closeOrderSuccess()" class="btn-primary full-width">Awesome!</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden">
        <span id="toast-message"></span>
    </div>
    <script src="supabase-client.js"></script>
    <script src="firebase-phone-auth.js"></script>
    <script src="script.js"></script>
</body>

</html>
